<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="A deep dive into selecting the right eBPF hook — tracepoints, kprobes, fentry, uprobes—for crafting powerful and stealthy Linux malware using libbpf." />
<meta name="keywords" content="mathscantor, ebpf, linux, malware" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="dark" />
<link rel="canonical" href="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-2-setting-appropriate-hooks/" />


    <title>
        
            eBPF Malware Techniques Part 2 - Setting Appropriate Hooks :: Mathscantor&#39;s Cybersecurity Blog  — A simple theme for Hugo
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.857f6b8067f4f0fba53dd2dc1af398f35db0ed3a4dd138cccf600756019e3c7f.css">





    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">



  <meta itemprop="name" content="eBPF Malware Techniques Part 2 - Setting Appropriate Hooks">
  <meta itemprop="description" content="A deep dive into selecting the right eBPF hook — tracepoints, kprobes, fentry, uprobes—for crafting powerful and stealthy Linux malware using libbpf.">
  <meta itemprop="datePublished" content="2025-04-11T23:42:35+08:00">
  <meta itemprop="dateModified" content="2025-04-11T23:42:35+08:00">
  <meta itemprop="wordCount" content="2052">
  <meta itemprop="image" content="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-2-setting-appropriate-hooks/images/cover.png">
  <meta itemprop="keywords" content="Ebpf,Linux,Malware">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-2-setting-appropriate-hooks/images/cover.png">
  <meta name="twitter:title" content="eBPF Malware Techniques Part 2 - Setting Appropriate Hooks">
  <meta name="twitter:description" content="A deep dive into selecting the right eBPF hook — tracepoints, kprobes, fentry, uprobes—for crafting powerful and stealthy Linux malware using libbpf.">



    <meta property="og:url" content="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-2-setting-appropriate-hooks/">
  <meta property="og:site_name" content="Mathscantor&#39;s Cybersecurity Blog">
  <meta property="og:title" content="eBPF Malware Techniques Part 2 - Setting Appropriate Hooks">
  <meta property="og:description" content="A deep dive into selecting the right eBPF hook — tracepoints, kprobes, fentry, uprobes—for crafting powerful and stealthy Linux malware using libbpf.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-04-11T23:42:35+08:00">
    <meta property="article:modified_time" content="2025-04-11T23:42:35+08:00">
    <meta property="article:tag" content="Ebpf">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Malware">
    <meta property="og:image" content="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-2-setting-appropriate-hooks/images/cover.png">
      <meta property="og:see_also" content="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-4-hiding-processes/">
      <meta property="og:see_also" content="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-3-hiding-bpf-traces/">
      <meta property="og:see_also" content="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-1-introduction/">






    <meta property="article:published_time" content="2025-04-11 23:42:35 &#43;0800 &#43;08" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span data-pagefind-ignore class="logo__text">Be You Cat, or Mouse?</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner">
            
            <div class="submenu">
                <li class="dropdown">
                    <a href="/posts/">
                        Posts
                    </a>
                </li>
            </div>
            
        
            
            <div class="submenu">
                <li class="dropdown">
                    <a href="/tags/">
                        Tags
                    </a>
                </li>
            </div>
            
        
            
            <div class="submenu">
                <li class="dropdown">
                    <a href="/series/">
                        Series
                    </a>
                </li>
            </div>
            
        
            
            <div class="submenu">
                <li class="dropdown">
                    <a href="/about">
                        About
                    </a>
                </li>
            </div>
            
        

    
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            <div class="content">
                

  <main class="post">
    
    <link href="/posts/css/toc.css" rel="stylesheet">
    <aside id="sticky-toc">
      <div class="toc-title">Table of Contents</div>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#1-introduction">1. Introduction</a></li>
    <li><a href="#2-tracepoints">2. Tracepoints</a>
      <ul>
        <li><a href="#21-checking-available-tracepoints">2.1 Checking Available Tracepoints</a></li>
        <li><a href="#22-understanding-tracepoint-args">2.2 Understanding Tracepoint Args</a></li>
      </ul>
    </li>
    <li><a href="#3-kprobe--kretprobe">3. Kprobe / Kretprobe</a>
      <ul>
        <li><a href="#31-checking-available-kprobes">3.1 Checking Available Kprobes</a></li>
        <li><a href="#32-understanding-kprobe-args">3.2 Understanding Kprobe Args</a></li>
      </ul>
    </li>
    <li><a href="#4-fentry--fexit">4. Fentry / Fexit</a></li>
    <li><a href="#5-uprobe--uretprobe">5. Uprobe &amp; Uretprobe</a></li>
    <li><a href="#6-conclusion">6. Conclusion</a></li>
  </ul>
</nav>
    </aside>
    <script src="/posts/js/toc.js"></script>
    
    <article>
      
      <div class="post-thumbnail">
          <img src="/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-2-setting-appropriate-hooks/images/cover.png" alt="post image" style="display: block; margin-left: auto; margin-right: auto; max-width: 50%; max-height: 50%; margin-bottom: 1em;">
      </div>
      
      <h1 class="post-title">
        <a href="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-2-setting-appropriate-hooks/">eBPF Malware Techniques Part 2 - Setting Appropriate Hooks</a>
      </h1>
      <div class="post-info">
        <p>
          <i class="fa-solid fa-clock"></i>
          10 Minutes
          <i class="fa-solid fa-clipboard"></i>
          2052 Words
          
        </p>
        <p>
          <i class="fa-solid fa-calendar-days"></i>
          
            2025-04-11 23:42
          
  
           
            
          
        </p>
        <p>
        <p>
          <i class="fa-solid fa-eye"></i>
          <span id="stats"></span>
<script>
(function() {
  var r = new XMLHttpRequest();
  r.addEventListener('load', function() {
    var statsEl = document.getElementById("stats");
    if (!statsEl) return;

    try {
      var count = JSON.parse(this.responseText).count_unique;
      console.log(count);
      statsEl.innerText = count == 1
        ? "1 View"
        : count + " Views";
    } catch (e) {
      console.error("GoatCounter stats error:", e);
    }
  });

  r.open('GET', 'https://mathscantor.goatcounter.com/counter/' +
    encodeURIComponent(location.pathname.replace(/(\/)?$/, '')) + '.json');
  r.send();
})();
</script>

        </p>
        
    <p>
        <i class="fa-solid fa-tag"></i>
        

        <span class="tag"><a href="https://mathscantor.github.io/tags/ebpf/">ebpf</a></span>
        <span class="tag"><a href="https://mathscantor.github.io/tags/linux/">linux</a></span>
        <span class="tag"><a href="https://mathscantor.github.io/tags/malware/">malware</a></span>
        
    </p>

      </br>
        </p>
      </div>
      
        <div class="post-excerpt">A deep dive into selecting the right eBPF hook — tracepoints, kprobes, fentry, uprobes—for crafting powerful and stealthy Linux malware using libbpf.</div>
      

      

      

      <div class="post-content">
        <hr>
        
          <div class="post-series"><h3 id="series"> eBPF Malware Techniques Series:</h3> 
    <ol><li><a href="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-1-introduction/">eBPF Malware Techniques Part 1 - Introduction</a></li><li><b>eBPF Malware Techniques Part 2 - Setting Appropriate Hooks</b></li><li><a href="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-3-hiding-bpf-traces/">eBPF Malware Techniques Part 3 - Hiding BPF Traces</a></li><li><a href="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-4-hiding-processes/">eBPF Malware Techniques Part 4 - Hiding Processes</a></li></ol></div>
          <hr>
        
        <h2 id="1-introduction">1. Introduction</h2>
<p>In my previous post, you were introduced to the 3 different major frameworks that eBPFs have to offer. I also briefly talked about how the logic of its hooks.</p>
<p>To begin crafting your own eBPF-based malware, you need to understand where and what to hook on to. You don’t just throw an eBPF program into the void and hope it latches onto something juicy. No — you need a plan, a strategy, and most importantly, knowledge of the landscape.</p>
<p>Thus, today’s focus will be on understanding the different types of hooks available, and when to use each to best achieve your goals:</p>
<ol>
<li><em>tracepoints</em>,</li>
<li><em>kprobe</em> / <em>kretprobe</em></li>
<li><em>fentry</em> / <em>fexit</em></li>
<li><em>uprobe</em> / <em>uretprobe</em></li>
</ol>
<p>Also, this part of the walkthrough will be purely based on the <em>libbpf</em> framework with snippets taken from <a href="https://github.com/libbpf/libbpf-bootstrap">libbpf-bootstrap</a> and <a href="https://github.com/iovisor/bcc/tree/master/libbpf-tools">bcc/libbpf-tools</a>.</p>
<h2 id="2-tracepoints">2. Tracepoints</h2>
<p>A tracepoint is a statically defined hook embedded within the Linux kernel. These are intentionally placed by kernel developers to expose important events or state changes — such as when a syscall is entered or exited, a scheduler event occurs, or memory is allocated.</p>
<p>Each tracepoint has a stable name, a well-defined structure, and exposes typed arguments that your eBPF programs can read. This makes them incredibly useful for observability and introspection.</p>
<h3 id="21-checking-available-tracepoints">2.1 Checking Available Tracepoints</h3>
<p>A great starting point is to look at <em>/sys/kernel/debug/tracing/available_events</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ cat /sys/kernel/debug/tracing/available_events
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>sched:sched_prepare_exec
</span></span><span style="display:flex;"><span>sched:sched_process_exec
</span></span><span style="display:flex;"><span>sched:sched_process_fork
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>syscalls:sys_exit_openat
</span></span><span style="display:flex;"><span>syscalls:sys_enter_openat
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Checking for Available Tracepoints<br><br></span>
<p>This command prints out all <em>tracepoints</em> currently available in your kernel. It&rsquo;s basically a buffet of potential targets. You’ll see categories like <em>syscalls</em>, <em>irq</em>, <em>sched</em>, <em>kmem</em>, and more.</p>
<p>If your goal is to monitor or manipulate user-level process behavior, the syscall <em>tracepoints</em> are particularly juicy. Why is this so? Let&rsquo;s take a look at a simple example of the <em>ls</em> process with <em>strace</em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ strace ls
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>openat<span style="color:#f92672">(</span>AT_FDCWD, <span style="color:#e6db74">&#34;.&#34;</span>, O_RDONLY|O_NONBLOCK|O_CLOEXEC|O_DIRECTORY<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>fstat<span style="color:#f92672">(</span>3, <span style="color:#f92672">{</span>st_mode<span style="color:#f92672">=</span>S_IFDIR|0750, st_size<span style="color:#f92672">=</span>798, ...<span style="color:#f92672">})</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>getdents64<span style="color:#f92672">(</span>3, 0x557cefd81710 /* <span style="color:#ae81ff">46</span> entries */, 32768<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1496</span>
</span></span><span style="display:flex;"><span>getdents64<span style="color:#f92672">(</span>3, 0x557cefd81710 /* <span style="color:#ae81ff">0</span> entries */, 32768<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>close<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Truncated Output of Strace on <em>ls</em> Process<br><br></span>
<p>We can see that the <em>ls</em> process is using the <em>getdents64</em> syscall for directory listing. If your goal was to hide certain files/directories, then you will have to target <code>syscalls:sys_enter_getdents64</code> and <code>syscalls:sys_exit_getdents64</code>. (Further exploration done in later part of this series)</p>
<p>Using the <em>libbpf</em> framework, your hookpoint will look something similar to this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">SEC</span>(<span style="color:#e6db74">&#34;tp/syscalls/sys_enter_getdents64&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">handle_getdents_enter</span>(<span style="color:#66d9ef">struct</span> trace_event_raw_sys_enter <span style="color:#f92672">*</span>ctx) {
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SEC</span>(<span style="color:#e6db74">&#34;tp/syscalls/sys_exit_getdents64&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">handle_getdents_exit</span>(<span style="color:#66d9ef">struct</span> trace_event_raw_sys_exit <span style="color:#f92672">*</span>ctx) {
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Example of <em>getdents64</em> Hooks<br><br></span>
<h3 id="22-understanding-tracepoint-args">2.2 Understanding Tracepoint Args</h3>
<p>Each tracepoint has its arguments format stored in the following format:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/sys/kernel/debug/tracing/events/&lt;tp_type&gt;/&lt;tp_name&gt;/format
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Tracepoint Format Path<br><br></span>
<p>To illustrate this, I am using back <code>syscalls:sys_enter_getdents64</code> as my example.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ cat /sys/kernel/debug/tracing/events/syscalls/sys_enter_getdents64/format
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>name: sys_enter_getdents64
</span></span><span style="display:flex;"><span>ID: <span style="color:#ae81ff">908</span>
</span></span><span style="display:flex;"><span>format:
</span></span><span style="display:flex;"><span>	field:unsigned short common_type;	offset:0;	size:2;	signed:0;
</span></span><span style="display:flex;"><span>	field:unsigned char common_flags;	offset:2;	size:1;	signed:0;
</span></span><span style="display:flex;"><span>	field:unsigned char common_preempt_count;	offset:3;	size:1;	signed:0;
</span></span><span style="display:flex;"><span>	field:int common_pid;	offset:4;	size:4;	signed:1;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	field:int __syscall_nr;	offset:8;	size:4;	signed:1;
</span></span><span style="display:flex;"><span>	field:unsigned int fd;	offset:16;	size:8;	signed:0;
</span></span><span style="display:flex;"><span>	field:struct linux_dirent64 * dirent;	offset:24;	size:8;	signed:0;
</span></span><span style="display:flex;"><span>	field:unsigned int count;	offset:32;	size:8;	signed:0;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print fmt: <span style="color:#e6db74">&#34;fd: 0x%08lx, dirent: 0x%08lx, count: 0x%08lx&#34;</span>, <span style="color:#f92672">((</span>unsigned long<span style="color:#f92672">)(</span>REC-&gt;fd<span style="color:#f92672">))</span>, <span style="color:#f92672">((</span>unsigned long<span style="color:#f92672">)(</span>REC-&gt;dirent<span style="color:#f92672">))</span>, <span style="color:#f92672">((</span>unsigned long<span style="color:#f92672">)(</span>REC-&gt;count<span style="color:#f92672">))</span>
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Format of syscalls:sys_enter_getdents64<br><br></span>
<p>The first argument of the <em>getdents64</em> syscall only starts after <code>int __syscall_nr</code>. So essentially, we are really only concerned with the following syscall parameters:</p>
<ol>
<li><code>unsigned int fd</code> – The file descriptor for the directory being read</li>
<li><code>struct linux_dirent64 *dirent</code> – A pointer to the buffer where directory entries will be stored</li>
<li><code>int count</code> – The maximum number of bytes to read into the buffer</li>
</ol>
<p>These arguments are passed to the tracepoint handler and can be accessed in your eBPF program via the <code>args</code> array of the <code>trace_event_raw_sys_enter</code> struct.</p>
<p>That’s why, when writing your eBPF handler for this tracepoint, it may look something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">SEC</span>(<span style="color:#e6db74">&#34;tp/syscalls/sys_enter_getdents64&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">handle_getdents_enter</span>(<span style="color:#66d9ef">struct</span> trace_event_raw_sys_enter <span style="color:#f92672">*</span>ctx) {
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> fd <span style="color:#f92672">=</span> ctx<span style="color:#f92672">-&gt;</span>args[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">struct</span> linux_dirent64 <span style="color:#f92672">*</span>dirent <span style="color:#f92672">=</span> (<span style="color:#66d9ef">struct</span> linux_dirent64 <span style="color:#f92672">*</span>)ctx<span style="color:#f92672">-&gt;</span>args[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> ctx<span style="color:#f92672">-&gt;</span>args[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Accessing Arguments Through <em>trace_event_raw_sys_enter</em> Struct<br><br></span>
<p>Alternatively, you can also define your own struct for cleaner argument access:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">// Self-Defined Struct
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> sys_enter_getdents64_format {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span> h;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int32_t</span> __syscall_nr;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint64_t</span> fd;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> linux_dirent64 <span style="color:#f92672">*</span>dirent;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint64_t</span> count;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SEC</span>(<span style="color:#e6db74">&#34;tp/syscalls/sys_enter_getdents64&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">handle_getdents_enter</span>(<span style="color:#66d9ef">struct</span> sys_enter_getdents64_format <span style="color:#f92672">*</span>format) {
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">uint64_t</span> fd <span style="color:#f92672">=</span> format<span style="color:#f92672">-&gt;</span>fd;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">struct</span> linux_dirent64 <span style="color:#f92672">*</span>dirent <span style="color:#f92672">=</span> format<span style="color:#f92672">-&gt;</span>dirent;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">uint64_t</span> count <span style="color:#f92672">=</span> format<span style="color:#f92672">-&gt;</span>count;
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Accessing Arguments Through Self-Defined Struct<br><br></span>
<h2 id="3-kprobe--kretprobe">3. Kprobe / Kretprobe</h2>
<p>So far, we&rsquo;ve explored <em>tracepoints</em> — stable and well-documented hooks that expose syscall arguments cleanly. But what if you want more power or need to hook internal kernel functions that don’t have <em>tracepoints</em>? This is where <em>kprobes</em> come in.</p>
<p>A <em>kprobe</em> lets you dynamically instrument almost any kernel function — not just syscalls or tracepoints. When that function is called, your <em>kprobe</em> hook gets executed right at the start (before the actual function logic runs).</p>
<p>A <em>kretprobe</em> is its sibling: it runs after the kernel function finishes executing, giving you access to the return value.</p>
<h3 id="31-checking-available-kprobes">3.1 Checking Available Kprobes</h3>
<p>The good news is — the kernel exposes a full list of available <em>kprobe</em> targets through the ftrace interface. Just run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ cat /sys/kernel/debug/tracing/available_filter_functions
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Listing Available Kprobe Targets<br><br></span>
<p>This will spit out thousands of functions, all which are fair game for <em>kprobes</em>, assuming your kernel was built with <em>CONFIG_KPROBES</em> and BPF support.</p>
<p>For example, to find file deletion logic, you might want to search for functions that contain the &ldquo;unlinkat&rdquo; substring:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ grep -i unlink /sys/kernel/debug/tracing/available_filter_functions
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>vfs_unlink
</span></span><span style="display:flex;"><span>do_unlinkat
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Listing Kprobe Targets Related to File Deletion<br><br></span>
<h3 id="32-understanding-kprobe-args">3.2 Understanding Kprobe Args</h3>
<p>In order to start writing out eBPF <em>kprobe</em> hooks, we need to identify the function prototype / definition of our <em>kprobe</em> target from the <a href="https://github.com/torvalds/linux">kernel source</a>.</p>
<p>Using <code>do_unlinkat</code> as an example, its function prototype is found in &ldquo;<em>fs/internal.h</em>&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">do_unlinkat</span>(<span style="color:#66d9ef">int</span> dfd, <span style="color:#66d9ef">struct</span> filename <span style="color:#f92672">*</span>name);
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Function Prototype of <em>do_unlinkat()</em><br><br></span>
<p>And with that, we are able to write our <em>kprobe</em> / <em>kretprobe</em> hook pairs as such:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">SEC</span>(<span style="color:#e6db74">&#34;kprobe/do_unlinkat&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BPF_KPROBE</span>(do_unlinkat_entry, <span style="color:#66d9ef">int</span> dfd, <span style="color:#66d9ef">struct</span> filename <span style="color:#f92672">*</span>name) {
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SEC</span>(<span style="color:#e6db74">&#34;kretprobe/do_unlinkat&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BPF_KRETPROBE</span>(do_unlinkat_exit, <span style="color:#66d9ef">long</span> ret) {
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Example of Kprobe/Kretprobe on <em>do_unlinkat()</em><br><br></span>
<p><em>BPF_KPROBE</em> is actually a macro that simplifies defining the function signature for a <em>kprobe</em>, by defining the lower-level <code>struct pt_regs *ctx</code> so you don’t have to manually extract arguments from CPU registers.</p>
<p>This macro is defined in &ldquo;<em>bpf_tracing.h</em>&rdquo;, which is generated during the build process (typically src/.output/bpf/bpf_tracing.h or a similar path, depending on your setup).</p>
<p>The macro expects two parts:</p>
<ol>
<li>The first argument is your handler function name — this can be anything you choose, as long as it matches the function signature.</li>
<li>The following arguments must match the parameters of the kernel function you&rsquo;re hooking onto.</li>
</ol>
<h2 id="4-fentry--fexit">4. Fentry / Fexit</h2>
<p>Now that you’ve seen how to use kprobes and kretprobes, let’s talk about their modern, more efficient cousins: fentry and fexit.</p>
<blockquote>
<p><a href="https://docs.ebpf.io/linux/program-type/BPF_PROG_TYPE_TRACING/#fentry">Fentry eBPF Docs</a>:</p>
<ul>
<li>Fentry programs are similar in function to a kprobe attached to a functions first instruction. This program type is invoked before control passes to the function to allow for tracing/observation.</li>
<li>Kprobes do not have to be attached at the entry point of a function, kprobes can be installed at any point in the function, whereas fentry programs are always attached at the entry point of a function.</li>
<li>Fentry programs are attached using a BPF trampoline which causes less overhead than kprobes</li>
</ul>
</blockquote>
<p>If you’re targeting a kernel function like <em>do_unlinkat()</em>, you can hook onto it using <em>fentry</em> (which runs at function entry) and <em>fexit</em> (which runs at function return) — just like <em>kprobe</em> and <em>kretprobe</em>.</p>
<p>Here’s what that looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">SEC</span>(<span style="color:#e6db74">&#34;fentry/do_unlinkat&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BPF_PROG</span>(do_unlinkat_entry, <span style="color:#66d9ef">int</span> dfd, <span style="color:#66d9ef">struct</span> filename <span style="color:#f92672">*</span>name) {
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SEC</span>(<span style="color:#e6db74">&#34;fexit/do_unlinkat&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BPF_PROG</span>(do_unlinkat_exit, <span style="color:#66d9ef">int</span> dfd, <span style="color:#66d9ef">struct</span> filename <span style="color:#f92672">*</span>name, <span style="color:#66d9ef">long</span> ret) {
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Example of Fentry/Fexit on <em>do_unlinkat()</em><br><br></span>
<p>There are lots of similarities to <em>kprobes</em>, the only difference being the macro and the function exit handler&rsquo;s arguments. Instead of <em>BPF_KPROBE</em>, we have to use <em>BPF_PROG</em> which is designed for <em>fentry</em>, <em>fexit</em> and BTF-enabled tracepoints (not covered in this series).</p>
<p>It does the same convenience wrapping — but this time around an <code>unsigned long long *ctx</code> argument, which holds the function arguments as a generic array. Again, you write the function prototype as if you&rsquo;re calling the real kernel function, and the macro handles the underlying casting.</p>
<h2 id="5-uprobe--uretprobe">5. Uprobe &amp; Uretprobe</h2>
<p>So far, we&rsquo;ve mainly explored kernel-space hooks — tracing functions inside the Linux kernel using <em>tracepoints</em>, <em>kprobe</em>/<em>kretprobe</em>, <em>fentry</em>/<em>fexit</em>. But, what if you want to observe user-space applications instead?</p>
<p>That’s where <em>uprobe</em> and <em>uretprobe</em> come in.</p>
<p><em>Uprobes</em> allow you to hook onto the entry and exit of user-space functions — much like <em>kprobes</em>, but for binaries like <em>/usr/bin/bash</em> or shared libraries like <em>/lib64/libc.so.6</em>. This is incredibly useful for directly messing around with user-space applications. You may think of this as <em>ptrace</em> on steroids as this <em>uprobes</em> can apply to all processes, including new ones that either run the binary or calls the target function from the shared library.</p>
<p>A classic example is <em>bashreadline</em> — where we trace user-entered shell commands by hooking onto the readline() function, which is used by interactive shells to read user input.</p>
<p>A full example of this can be found in the <a href="https://github.com/iovisor/bcc/tree/master/libbpf-tools">libbpf-tools</a> <em>bashreadline</em> program from the iovisor repository. As the example they provided only showed the usage of <em>uretprobe</em>, I have taken the liberty to show you what it will look like if you included a <em>uprobe</em> for it.</p>
<p>At a glance, a simplified version of what these hooks look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">SEC</span>(<span style="color:#e6db74">&#34;uprobe&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BPF_UPROBE</span>(printline, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>prompt) {
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SEC</span>(<span style="color:#e6db74">&#34;uretprobe&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BPF_URETPROBE</span>(printret, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>ret) {
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Example of uprobe/uretprobe<br><br></span>
<p>In the original libbpf-tools example, you’ll notice that the program uses slightly more descriptive section names like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">SEC</span>(<span style="color:#e6db74">&#34;uretprobe/readline&#34;</span>)
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Bashreadline Original Section Header<br><br></span>
<p>But this is purely a naming convention for clarity! The section string could be just <code>SEC(&quot;uretprobe&quot;)</code> or <code>SEC(&quot;uprobe&quot;)</code> — the real magic happens at attach time, when you tell the kernel which binary and which offset to monitor.</p>
<p>This is usually done by using a helper function to resolve the function’s offset inside the ELF binary — for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>func_off <span style="color:#f92672">=</span> <span style="color:#a6e22e">get_elf_func_offset</span>(readline_so_path, 
</span></span><span style="display:flex;"><span>                   <span style="color:#a6e22e">find_readline_function_name</span>(readline_so_path));
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Getting Function Offset of <em>readline()</em> / <em>internal_readline_teardown()</em>&quot;<br><br></span>
<p>And then attach our <em>uprobe</em> and <em>uretprobe</em> like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>obj<span style="color:#f92672">-&gt;</span>links.printline <span style="color:#f92672">=</span> <span style="color:#a6e22e">bpf_program__attach_uprobe</span>(obj<span style="color:#f92672">-&gt;</span>progs.printline, 
</span></span><span style="display:flex;"><span>                      false,  <span style="color:#75715e">// false = uprobe (function entry)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                      <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,     <span style="color:#75715e">// -1 = all processes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                      readline_so_path, func_off);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>obj<span style="color:#f92672">-&gt;</span>links.printret <span style="color:#f92672">=</span> <span style="color:#a6e22e">bpf_program__attach_uprobe</span>(obj<span style="color:#f92672">-&gt;</span>progs.printret, 
</span></span><span style="display:flex;"><span>                      true,  <span style="color:#75715e">// true = uretprobe (function exit)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                      <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,    <span style="color:#75715e">// all processes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                      readline_so_path, func_off);
</span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Getting Function Offset of <em>readline()</em> / <em>internal_readline_teardown()</em>&quot;<br><br></span>
<p>So even though your <em>SEC()</em> string might look like &ldquo;uretprobe/readline&rdquo;, it’s the <em>bpf_program__attach_uprobe()</em> call that actually binds the hook to a specific binary and offset — not the section name.</p>
<p>This separation makes the program more reusable and modular. You could write a single generic uprobe BPF program, and at runtime attach it to any ELF function in any user-space binary, as long as you know its offset.</p>
<p>One last interesting detail worth mentioning - Even though you’re using <em>BPF_UPROBE</em> and <em>BPF_URETPROBE</em> in your eBPF programs, under the hood these are simply aliases for <em>BPF_KPROBE</em> and <em>BPF_KRETPROBE</em>.</p>
<p>Here’s the exact snippet from bpf_tracing.h:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">/* BPF_UPROBE and BPF_URETPROBE are identical to BPF_KPROBE and BPF_KRETPROBE,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * but are named way less confusingly for SEC(&#34;uprobe&#34;) and SEC(&#34;uretprobe&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * use cases.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define BPF_UPROBE(name, args...)      BPF_KPROBE(name, ##args)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define BPF_URETPROBE(name, args...)   BPF_KRETPROBE(name, ##args)
</span></span></span></code></pre></div><link href="/posts/css/caption.css" rel="stylesheet">
<span class="caption" data-type="listing">Macro Aliases for <em>uprobe</em>/<em>uretprobe</em><br><br></span>
<p>As stated by the author in the comments, this is just to reduce confusion when writing/reviewing code.</p>
<h2 id="6-conclusion">6. Conclusion</h2>
<p>n this post, you’ve learned how to choose the right eBPF hook for your goals. Whether you&rsquo;re aiming to monitor or manipulate behavior, understanding the strengths of each hook type is essential.</p>
<p><em>Tracepoints</em> are stable, kernel-defined spots ideal for observing system calls and structured events — perfect for tasks like monitoring directory listings.</p>
<p><em>Kprobes</em> / <em>Kretprobes</em> let you hook any kernel function dynamically, even ones without tracepoints. They’re your go-to when you need to monitor internal kernel logic.</p>
<p><em>Fentry</em> / <em>Fexit</em> are modern, more efficient alternatives to kprobes. They offer lower overhead and a cleaner way to hook function entry and exit — if BTF data is available on your target system.</p>
<p><em>Uprobes</em> / <em>Uretprobes</em> let you hook user-space binaries and libraries, giving you visibility into application-level logic — think of it as tracing processes beyond the kernel, like reading user commands from Bash.</p>
<p>Mastering these hooks is the foundation for crafting reliable and stealthy eBPF-based malware or tools. In the next post, I will be sharing some stealth techniques exhibited by <a href="https://github.com/eeriedusk/nysm"><em>nysm</em></a>.</p>

        
          <hr>
          <div class="post-series"><h3 id="series"> eBPF Malware Techniques Series:</h3> 
    <ol><li><a href="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-1-introduction/">eBPF Malware Techniques Part 1 - Introduction</a></li><li><b>eBPF Malware Techniques Part 2 - Setting Appropriate Hooks</b></li><li><a href="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-3-hiding-bpf-traces/">eBPF Malware Techniques Part 3 - Hiding BPF Traces</a></li><li><a href="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-4-hiding-processes/">eBPF Malware Techniques Part 4 - Hiding Processes</a></li></ol></div>
        
      </div>
    </article>

    <div class="post-info">
      
    <div class="pagination">
        
        <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
        </div>
        

        <div class="pagination__buttons">

            
            <span class="button previous">
                <a href="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-1-introduction/">
                    <span class="button__icon">←</span>
                    <span class="button__text">eBPF Malware Techniques Part 1 - Introduction</span>
                </a>
            </span>
            

            
            <span class="button next">
                <a href="https://mathscantor.github.io/posts/ebpf-malware-techniques/ebpf-malware-techniques-part-3-hiding-bpf-traces/">
                    <span class="button__text">eBPF Malware Techniques Part 3 - Hiding BPF Traces</span>
                    <span class="button__icon">→</span>
                </a>
            </span>
            

        </div>
    </div>

    </div>
      <div class="sharing-buttons">
        
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmathscantor.github.io%2fposts%2febpf-malware-techniques%2febpf-malware-techniques-part-2-setting-appropriate-hooks%2f" target="_blank" rel="noopener" aria-label="" title="Share on facebook">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmathscantor.github.io%2fposts%2febpf-malware-techniques%2febpf-malware-techniques-part-2-setting-appropriate-hooks%2f" target="_blank" rel="noopener" aria-label="" title="Share on twitter">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
      <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=eBPF%20Malware%20Techniques%20Part%202%20-%20Setting%20Appropriate%20Hooks&amp;caption=eBPF%20Malware%20Techniques%20Part%202%20-%20Setting%20Appropriate%20Hooks&amp;canonicalUrl=https%3a%2f%2fmathscantor.github.io%2fposts%2febpf-malware-techniques%2febpf-malware-techniques-part-2-setting-appropriate-hooks%2f" target="_blank" rel="noopener" aria-label="" title="Share on tumblr">
  <div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small">
    <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093 0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941 0 9.999 0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="mailto:?subject=eBPF%20Malware%20Techniques%20Part%202%20-%20Setting%20Appropriate%20Hooks&amp;body=https%3a%2f%2fmathscantor.github.io%2fposts%2febpf-malware-techniques%2febpf-malware-techniques-part-2-setting-appropriate-hooks%2f" target="_self" rel="noopener" aria-label="" title="Share via email">
  <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmathscantor.github.io%2fposts%2febpf-malware-techniques%2febpf-malware-techniques-part-2-setting-appropriate-hooks%2f&amp;media=https%3a%2f%2fmathscantor.github.io%2fposts%2febpf-malware-techniques%2febpf-malware-techniques-part-2-setting-appropriate-hooks%2f;description=eBPF%20Malware%20Techniques%20Part%202%20-%20Setting%20Appropriate%20Hooks" target="_blank" rel="noopener" aria-label="" title="Share on pinterest">
  <div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607 0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017 0z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmathscantor.github.io%2fposts%2febpf-malware-techniques%2febpf-malware-techniques-part-2-setting-appropriate-hooks%2f&amp;title=eBPF%20Malware%20Techniques%20Part%202%20-%20Setting%20Appropriate%20Hooks&amp;summary=eBPF%20Malware%20Techniques%20Part%202%20-%20Setting%20Appropriate%20Hooks&amp;source=https%3a%2f%2fmathscantor.github.io%2fposts%2febpf-malware-techniques%2febpf-malware-techniques-part-2-setting-appropriate-hooks%2f" target="_blank" rel="noopener" aria-label="" title="Share on linkedin">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3a%2f%2fmathscantor.github.io%2fposts%2febpf-malware-techniques%2febpf-malware-techniques-part-2-setting-appropriate-hooks%2f&amp;resubmit=true&amp;title=eBPF%20Malware%20Techniques%20Part%202%20-%20Setting%20Appropriate%20Hooks" target="_blank" rel="noopener" aria-label="" title="Share on reddit">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2fmathscantor.github.io%2fposts%2febpf-malware-techniques%2febpf-malware-techniques-part-2-setting-appropriate-hooks%2f;title=eBPF%20Malware%20Techniques%20Part%202%20-%20Setting%20Appropriate%20Hooks" target="_blank" rel="noopener" aria-label="" title="Share on xing">
  <div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="whatsapp://send?text=eBPF%20Malware%20Techniques%20Part%202%20-%20Setting%20Appropriate%20Hooks%20https%3a%2f%2fmathscantor.github.io%2fposts%2febpf-malware-techniques%2febpf-malware-techniques-part-2-setting-appropriate-hooks%2f" target="_blank" rel="noopener" aria-label="" title="Share on whatsapp">
  <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fmathscantor.github.io%2fposts%2febpf-malware-techniques%2febpf-malware-techniques-part-2-setting-appropriate-hooks%2f&amp;t=eBPF%20Malware%20Techniques%20Part%202%20-%20Setting%20Appropriate%20Hooks" target="_blank" rel="noopener" aria-label="" title="Share on hacker news">
  <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=eBPF%20Malware%20Techniques%20Part%202%20-%20Setting%20Appropriate%20Hooks&amp;url=https%3a%2f%2fmathscantor.github.io%2fposts%2febpf-malware-techniques%2febpf-malware-techniques-part-2-setting-appropriate-hooks%2f" target="_blank" rel="noopener" aria-label="" title="Share on telegram">
  <div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
    </div>
  </div>
</a>

      </div>


    

    

  </main>

            </div>

            
                <footer class="footer">
    
    
    
        <div class="footer__inner">
            <div class="footer__content">
            
            
        </div>
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.efa6b6352b1e4d712533d2fbd29f0c899eb1474e0f181433c934e6c6fdd3678ff834c116423c957d7a6ff6763e9c0d599a82208cdeae81c4a483e37853c46360.js" integrity="sha512-76a2NSseTXElM9L70p8MiZ6xR04PGBQzyTTmxv3TZ4/4NMEWQjyVfXpv9nY&#43;nA1ZmoIgjN6ugcSkg&#43;N4U8RjYA=="></script>



        <script src='/posts/js/caption.js'></script>
        <script data-goatcounter="https://mathscantor.goatcounter.com/count"
        async src="//gc.zgo.at/count.js">console.log("Goat Analytics Loaded");</script>
    </body>
</html>
